<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    <title>Admin Panel</title>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="css/adminpanelstyle.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
            integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
            crossorigin="anonymous"></script>

    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
            integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
            crossorigin="anonymous"></script>

    <!-- For Google Maps -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDFPZg9v7DZWuQKX0pk_wTyJEmHalRU0tA"></script>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- Custom JS -->
    <script src="js/auth.js"></script>
    <script src="js/designer.js"></script>
    <script src="js/server.api.js"></script>
    <script src="js/public_requests.js"></script>
    <script src="js/admin_requests.js"></script>
    <script src="js/maps.js"></script>
    <script>
      rejectAdmin();
    </script>

</head>
<body>
<div class="wrapper">
    <!-- Sidebar Admin Panel -->
    <nav id="sidebar" style="border-right: 10px #0b0b0b ">
        <div class="sidebar-header">
            <a href="#" onclick="toggleVisibility('A0');"><h3>Admin Panel</h3></a>
        </div>
        <ul class="list-unstyled">
            <li>
                <a href="#kvartsubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Kvartovska
                    poduzeća</a>
                <ul class="collapse list-unstyled" id="kvartsubmenu">
                    <li>
                        <a href="#" onclick="toggleVisibility('A1'); initAddHoodMap();">Dodaj novo</a>
                    </li>
                    <li>
                        <a href="#" onclick="toggleVisibility('A2'); loadHoods();">Obriši postojeće</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="#kontejnersubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Kontejneri</a>
                <ul class="collapse list-unstyled" id="kontejnersubmenu">
                    <li>
                        <a href="#" onclick="toggleVisibility('B1'); initAddContMap(); loadHoods();">Dodaj novi</a>
                    </li>
                    <li>
                        <a href="#" onclick="toggleVisibility('B2'); loadContainers();">Obriši postojeći</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="#pageSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Komunalni
                    radnici</a>
                <ul class="collapse list-unstyled" id="pageSubmenu">
                    <li>
                        <a href="#" onclick="toggleVisibility('C1');">Dodaj novog radnika</a>
                    </li>
                    <li>
                        <a href="#" onclick="toggleVisibility('C2');">Premjesti postojećeg radnika</a>
                    </li>
                    <li>
                        <a href="#" onclick="toggleVisibility('C3');">Izbriši postojećeg radnika</a>
                    </li>
                </ul>
            </li>
        </ul>
    </nav>

    <!-- Masthead -->
    <div class="container h-100" id="A0">
        <div class="row h-100 align-items-center justify-content-center text-center">
            <div class="col-lg-10 align-self-end">
                <h1 style="padding-top: 50px" class="text-uppercase text-black-50 font-weight-bold" id="welcome-msg">
                    Dobrodošli u Admin Panel</h1>
                <hr class="divider my-lg-4">
            </div>
        </div>
    </div>

    <!-- Dodavanje novog kvartovskog poduzeća -->
    <div id="A1" style="display: none; margin-bottom: 50px;">
        <div id='new-hood-map' style="height: 550px;"></div>
        <div >
            <div style="margin-top: 50px;">
                <p id="new-hood-current">Pomaknite marker na karti kako bi ste odabrali središte novog kvartovskog poduzeća.</p>
            </div>
            <div>
                <form method="POST" onsubmit="event.preventDefault(); doNewNeighborhood();">
                    <p>
                        <label>Ime novog kvartovskog poduzeća:
                            <input type="text" id="new-hood-name">
                        </label>
                    </p>
                        <input type="submit" class="btn btn-primary btn-xl" style="background-color: #EB6038; border-color: #EB6038"
                            name="new-hood" id="new-hood" value="Potvrdi"/>
                </form>
            </div>
        </div>
    </div>

    <!-- Brisanje postojećeg kvartovskog poduzeća -->
    <div id="A2" style="display: none;">
      <div id="del-hood-map" style="height: 550px;"></div>
      <div>
          <div>
              <p id="del-hood-current">Odaberite kvartovsko poduzeće koje želite obrisati.</p>
              <ul id="del-hood-list"></ul>
              <button class="btn btn-primary btn-xl" onclick="doDeleteNeighborhood()" style="background-color: #EB6038; border-color: #EB6038">
                Izbriši
              </button>
          </div>
      </div>
    </div>

    <!-- Dodavanje novog kontejnera -->
    <div id="B1" style="display: none; margin-bottom: 50px; text-align: center;">
        <div id='add-cont-map'  style="height: 550px;"></div>
        <div>
            <div style="margin-top: 50px;">
                <p id="add-cont-current">Pomaknite marker na karti kako bi ste odabrali lokaciju novog kontejnera.</p>
            </div>
            <div>
              <form method="POST" onsubmit="event.preventDefault(); doNewContainer();">
                <label for="sel1"><p>Odaberite kojem kvartovskom poduzeću pripada kontejner koji želite dodati:</p>
                </label>
                <select class="form-control" id="sel1" style="display: inline-block; width: 100px">
                </select><br>
                <input type="submit" class="btn btn-primary btn-xl" style="background-color: #EB6038; border-color: #EB6038"
                       name="add-cont" id="add-cont" value="Potvrdi"/>
              </form>
            </div>
        </div>
    </div>

    <!-- Brisanje postojećeg kontejnera -->
    <div id="B2" align="center" style="display: none;">
      <div id="del-cont-map" style="height: 550px;"></div>
      <div>
          <div>
              <p id="del-cont-current">Na karti odaberite kontejner koji želite obrisati.</p>
              <button class="btn btn-primary btn-xl" onclick="doDeleteContainer()" style="background-color: #EB6038; border-color: #EB6038">
                Izbriši
              </button>
          </div>
      </div>
    </div>

    <!-- Upravljanje komunalnim radnicima -->
    <div id="C1" style="display: none;">Dodaj novog radnika</div>
    <div id="C2" style="display: none;">Premjesti postojećeg radnika</div>
    <div id="C3" style="display: none;">Izbriši postojećeg radnika</div>

</div>

<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>

<script>
  var ADD_HOOD_LAT = null;
  var ADD_HOOD_LON = null;

  var ADD_CONT_LAT = null;
  var ADD_CONT_LON = null;

  var DEL_HOOD_SELECTED = null;
  var DEL_CONT_SELECTED = null;

  var HOOD_LIST = document.getElementById("del-hood-list");
  var OPTIONS = document.getElementById("sel1");

  function initAddHoodMap(){
    var map0 = createMap("new-hood-map", 45.814, 15.980);
    var addHoodMarker = createSelectorMarker(map0, 45.814, 15.980);

    google.maps.event.addListener(addHoodMarker, 'dragend', function (evt) {
        ADD_HOOD_LAT = evt.latLng.lat().toFixed(6);
        ADD_HOOD_LON = evt.latLng.lng().toFixed(6);
        document.getElementById('new-hood-current').innerHTML = 'Lokacija: '+ADD_HOOD_LAT+', '+ADD_HOOD_LON;
    });
    google.maps.event.addListener(addHoodMarker, 'dragstart', function (evt) {
        document.getElementById('new-hood-current').innerHTML = 'Trenutno pomičete marker.';
    });
  }

  function initAddContMap() {
    var map0 = createMap("add-cont-map", 45.814, 15.980);
    var addContMarker = createSelectorMarker(map0, 45.814, 15.980);

    google.maps.event.addListener(addContMarker, 'dragend', function (evt) {
        ADD_CONT_LAT = evt.latLng.lat().toFixed(6);
        ADD_CONT_LON = evt.latLng.lng().toFixed(6);
        document.getElementById('add-cont-current').innerHTML = 'Lokacija: '+ADD_CONT_LAT+', '+ADD_CONT_LON;
    });
    google.maps.event.addListener(addContMarker, 'dragstart', function (evt) {
        document.getElementById('add-cont-current').innerHTML = 'Trenutno pomičete marker.';
    });
  }

  function resetNewHoodHolders(){
    ADD_HOOD_LAT = null;
    ADD_HOOD_LON = null;
    document.getElementById('new-hood-current').innerHTML = "Pomaknite marker na karti kako biste odabrali središte novog kvartovskog poduzeća.";
  }

  function resetNewContainerHolders(){
    ADD_CONT_LAT = null;
    ADD_CONT_LON = null;
    document.getElementById('add-cont-current').innerHTML = "Pomaknite marker na karti kako biste odabrali lokaciju novog kontejnera.";
  }

  function reactHoodClick(title, hoodID){
    if(!(title && hoodID)){
      document.getElementById("del-hood-current").innerHTML = "Odaberite kvartovsko poduzeće koje želite obrisati.";
      DEL_HOOD_SELECTED = null;
      return;
    }
    DEL_HOOD_SELECTED = hoodID;
    document.getElementById("del-hood-current").innerHTML = "Odabrano poduzeće: "+title+" ("+hoodID+")";
  }

  function reactContainerClick(contID){
    if(!contID){
      document.getElementById("del-cont-current").innerHTML = "Odaberite kontejner koji želite obrisati.";
      DEL_CONT_SELECTED = null;
      return;
    }
    DEL_CONT_SELECTED = contID;
    document.getElementById("del-cont-current").innerHTML = "Odabran kontejner ("+contID+")";
  }

  function loadHoods() {
    var mapDH = createMap("del-hood-map", 45.814, 15.980);
    getNeighborhoods( function(hoods) {
      HOOD_LIST.innerHTML = "";
      OPTIONS.innerHTML = "";
      for(var i=0; i<hoods.length; i++){
        var h = hoods[i];
        var marker = createNeighborhoodMarker(h, mapDH);
        google.maps.event.addListener(marker, 'click', function(){
          reactHoodClick(this.title, this.hoodID);
        })
        var functionCall = "reactHoodClick(\""+h.name+"\","+h.id+");";
        HOOD_LIST.innerHTML = HOOD_LIST.innerHTML
          + "<li onclick='"+functionCall+"'>"+h.name+" --- "+h.id+" --- ("+h.latitude+","+h.longitude+")</li>";
        OPTIONS.innerHTML = OPTIONS.innerHTML
          + "<option value='"+h.id+"'>"+h.name+"</option>";
      }
    });
  }

  function loadContainers() {
    var mapDC = createMap("del-cont-map", 45.814, 15.980);
    getContainers( function(containers) {
      for(var i=0; i<containers.length; i++){
        var marker = createContainerMarker(containers[i], mapDC, "red");
        google.maps.event.addListener(marker, 'click', function(){
          reactContainerClick(this.contID);
        });
      }
    });
  }

  function doNewNeighborhood() {
      var hoodName = document.getElementById("new-hood-name").value;
      if(!hoodName){
        alert("Ime kvartovskog poduzeća je obavezno");
        return;
      }
      if(!(ADD_HOOD_LAT && ADD_HOOD_LON)){
        alert("Prije potvrde morate odabrati lokaciju poduzeća na karti");
        return;
      }
      postNeighborhood({
        name: hoodName,
        centerLatitude: ADD_HOOD_LAT,
        centerLongitude: ADD_HOOD_LON
      });
      resetNewHoodHolders();
    }

  function doNewContainer() {
      if(!(ADD_CONT_LAT && ADD_CONT_LON)){
        alert("Prije potvrde morate odabrati lokaciju kontejnera na karti");
        return;
      }
      var hoodId = OPTIONS.options[OPTIONS.selectedIndex].value;
      postContainer({
        neighborhoodId: hoodId,
        latitude: ADD_CONT_LAT,
        longitude: ADD_CONT_LON
      });
      resetNewContainerHolders();
  }

  function doDeleteNeighborhood() {
    if(!DEL_HOOD_SELECTED) {
      alert("Potrebno je odabrati susjedstvo koje želite obrisati.");
      return;
    }
    deleteNeighborhood(DEL_HOOD_SELECTED);
    reactHoodClick(null, null);
    loadHoods();
  }
  function doDeleteContainer() {
    if(!DEL_CONT_SELECTED){
      alert("Potrebno je odabrati kontejner koji želite obrisati.");
    }
    deleteContainer(DEL_CONT_SELECTED);
    reactContainerClick(null);
    loadContainers();
  }

</script>

<!-- Skripta za prikaz pojedinih blokova ovisno o tome koji dio admin sučelja je odabran -->
<script>
    var divs = ["A0", "A1", "A2", "B1", "B2", "C1", "C2", "C3"];
    var visibleDivId = null;

    function toggleVisibility(divId) {
        if (visibleDivId === divId) {
            visibleDivId = null;
        } else {
            visibleDivId = divId;
        }
        hideNonVisibleDivs();
    }

    function hideNonVisibleDivs() {
        var i, divId, div;
        for (i = 0; i < divs.length; i++) {
            divId = divs[i];
            div = document.getElementById(divId);
            if (visibleDivId === divId) {
                div.style.display = "block";
            } else {
                div.style.display = "none";
            }
        }
    }
</script>
</body>
</html>
