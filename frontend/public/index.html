<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Manje smeće - više sreće</title>

    <!-- Font Awesome Icons -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic'
          rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

    <!-- Theme CSS - Includes Bootstrap -->
    <link href="css/creative.min.css" rel="stylesheet">

</head>

<body id="page-top">

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
    <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">KOMBINACIJA</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText"
	                aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
	            <span class="navbar-toggler-icon"></span>
	        </button>
	        <div class="collapse navbar-collapse" id="navbarText">
	            <ul class="nav navbar-nav navbar-right ml-auto" >
	                <li>
	                    <a href="admin.html">
	                        <button class="btn btn-primary btn-xl js-scroll-trigger" id="go-admin"
	                                style="margin: 5px; padding: 0.8rem 1.25rem; display: none">Admin panel
	                        </button>
	                    </a>
	                </li>
	                <li>
	                    <a href="citizen.html">
	                        <button class="btn btn-primary btn-xl js-scroll-trigger" id="go-citizen"
	                                style="margin: 5px; padding: 0.8rem 1.25rem; display: none">Prijavi kontejner
	                        </button>
	                    </a>
	                </li>
	                <li>
	                    <a href="employee.html">
	                        <button class="btn btn-primary btn-xl js-scroll-trigger" id="go-employee"
	                                style="margin: 5px; padding: 0.8rem 1.25rem; display: none">Zatraži rutu
	                        </button>
	                    </a>
	                </li>
	                <li>
	                    <button class="btn btn-primary btn-xl js-scroll-trigger"
	                            style="margin: 5px; padding: 0.8rem 1.25rem;" onclick="logMeOut();" id="logout">
	                        Odjavi se
	                    </button>
	                </li>
	                <li>
	                    <button class="btn btn-primary btn-xl js-scroll-trigger"
	                            style="margin: 5px; padding: 0.8rem 1.25rem;"
	                            onclick="window.location.replace('registracija.html');" id="register">
	                        Registriraj se
	                    </button>
	                </li>
	            </ul>
	        </div>
    </div>
</nav>

<!-- Masthead -->
<header class="masthead">
    <div class="container h-100">
        <div class="row h-100 align-items-center justify-content-center text-center">
            <div class="col-lg-10 align-self-end">
                <h1 class="text-uppercase text-white font-weight-bold" id="welcome-msg">Pomozite nam održati grad
                    čistim</h1>
                <hr class="divider my-4">
            </div>
            <div class="col-lg-8 align-self-baseline">
                <p class="text-white-75 font-weight-light mb-5">Svaka puna kanta može biti prijavljena!</p>
                <a class="btn btn-primary btn-xl js-scroll-trigger" href="prijava.html" id="login-link">Prijavi se</a>
            </div>
        </div>
    </div>
</header>


<!-- Services Section -->
<section class="page-section" id="services">
    <div class="container">
        <h2 class="text-center mt-0">ZAŠTO KOMBINACIJA?</h2>
        <hr class="divider my-4">
        <div class="row">
            <div class="col-lg-3 col-md-6 col-6 text-center">
                <div class="mt-5">
                    <i class="fas fa-4x fa-cogs text-primary mb-4"></i>
                    <h3 class="h4 mb-2">Zato što je jednostavna.</h3>
                    <p class="text-muted mb-0">Intuitivna aplikacija za prijavu punih kanti!</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-6 text-center">
                <div class="mt-5">
                    <i class="fas fa-4x fa-laptop-code text-primary mb-4"></i>
                    <h3 class="h4 mb-2">Zato jer radi na svim uređajima.</h3>
                    <p class="text-muted mb-0">Neovisno o tome koritite li laptop ili mobitel!</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-6 text-center">
                <div class="mt-5">
                    <i class="fas fa-4x fa-map text-primary mb-4"></i>
                    <h3 class="h4 mb-2">Zato jer pokriva cijeli grad.</h3>
                    <p class="text-muted mb-0">Gotovo sve kante su obilježene!</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-6 text-center">
                <div class="mt-5">
                    <i class="fas fa-4x fa-heart text-primary mb-4"></i>
                    <h3 class="h4 mb-2">Zato što je od građana za građane.</h3>
                    <p class="text-muted mb-0">Aplikacija je razvijena od strane studenata FER-a za sve!</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!--Google map-->
<div align="center">
  <button id="btn-history" type="button" class="btn btn-primary btn-xl" onclick="doGetHistory();" data-toggle="modal" data-target="#popupEvents"
          style="margin-bottom: 30px; position: center; padding: 0.8rem 1.25rem; display: none;">Dohvati povijest kontejnera
  </button>
  <p id="map-tip">Odaberite jedan od kontejnera na karti.</p>
  <table id="event-table" class="table" style="display:none;">
  </table>
  <div id="map_canvas" style="width: 88%; height: 500px;">
  </div>
</div>

<div id="popupEvents" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg" >
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"> Povijest događaja </h4>
      </div>
      <div class="modal-body">
        <table id="events" class="table">
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="bg-light py-4">
    <div class="container">
        <div class="small text-center text-muted">Copyright &copy; OPP Kombinacija</div>
    </div>
</footer>

<!-- Bootstrap core JavaScript -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Plugin JavaScript -->
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
<script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

<!-- Custom scripts for this template -->
<script src="js/creative.min.js"></script>
<script src="js/server.api.js"></script>
<script src="js/auth.js"></script>
<script src="js/designer.js"></script>
<script src="js/public_requests.js"></script>
<script src="js/citizen_requests.js"></script>
<script src="js/maps.js"></script>

<script>
    window.onload = handleDisplay();
</script>

<script src="https://maps.googleapis.com/maps/api/js?v=3.11&sensor=false&key=AIzaSyDFPZg9v7DZWuQKX0pk_wTyJEmHalRU0tA" type="text/javascript"></script>

  <script type="text/javascript">
    var SEL_CONTAINER = null;
    var LOADED_HOOD_MARKERS = [];
    var GMAP = createMap("map_canvas", 45.814, 15.980);

    function receiveContainers(containers){
      document.getElementById("map-tip").innerHTML = "Odaberite jedan od kontejnera na karti.";
      for(var i=0; i<containers.length; i++){
        var marker = createContainerMarker(containers[i], GMAP, "red");
        google.maps.event.addListener(marker, 'click', function () {
          SEL_CONTAINER = this.contID;
          document.getElementById("btn-history").style.display="block";
          document.getElementById("event-table").style.display="none";
          document.getElementById("map-tip").innerHTML = "Odabran je kontejner ("+this.contID+")";
        });
      }
    }

    function receiveNeighborhoods(hoods){
      document.getElementById("map-tip").innerHTML = "Odaberite susjedstvo čije kontejnere želite dohvatiti i prikazati.";
      for(var i=0; i<hoods.length; i++){
        var marker = createNeighborhoodMarker(hoods[i], GMAP);
        LOADED_HOOD_MARKERS.push(marker);

        google.maps.event.addListener(marker, 'click', function(){
          for(var j=0; j<LOADED_HOOD_MARKERS.length; j++){
            LOADED_HOOD_MARKERS[j].setMap(null);
          }
          mapHood(this.hoodID, receiveContainers);
        });
      }
    }

    function receiveEvents(events){
      var tbl = document.getElementById("events");
      tbl.innerHTML="";
      var swap = "<tr><th>Događaj</th><th>Autor</th><th>Vrijeme</th></tr>";
      for(var i=0; i<events.length; i++){
        swap += formatEvent(events[i]);
      }
      tbl.innerHTML = swap;
    }

    function initMap(position) {
      map(position.coords.latitude, position.coords.longitude, receiveContainers);
    }

    function initMapHood() {
      getHoods( receiveNeighborhoods );
    }

    function doGetHistory(){
      if(SEL_CONTAINER==null){
        alert("Za dohvat povijesti potrebno je prvo odabrati kontejner.");
        return;
      }
      getHistory(SEL_CONTAINER, receiveEvents);
      SEL_CONTAINER = null;
      document.getElementById("map-tip").innerHTML = "Odaberite jedan od kontejnera na karti.";
    }

    function formatEvent(evt){
      var title;
      if(evt.type=="PING-F"){
        title = "Prijavljen: PUN";
      } else if(evt.type=="PING-U"){
        title = "Prijavljen: PREPUN";
      } else if(evt.type=="PING-E"){
        title = "Prijavljen: PRAZAN";
      } else if(evt.type=="EMPTYING"){
        title = "Ispražnjen.";
      }
      var dt = new Date(parseInt(evt.timestamp, 10));
      var date = formatDate(parseInt(evt.timestamp));
      return "<tr><td>"+title+"</td><td>"+evt.creator+"</td><td>"+date+"</td></tr>";
    }

    function formatDate(ts){
      var dt = new Date(ts);
      var string = "";
      string+= (dt.getDate()>=10) ? dt.getDate() : "0"+dt.getDate();
      string+= "/";
      string+= (dt.getMonth()+1 >= 10) ? (dt.getMonth()+1) : "0"+(dt.getMonth()+1);
      string+="/";
      string+= dt.getFullYear();
      string+=" @";
      string+= (dt.getHours()>=10) ? dt.getHours() : "0"+dt.getHours();
      string+=":"
      string+= (dt.getMinutes()>=10) ? dt.getMinutes() : "0"+dt.getMinutes();
      return string;
    }

    window.onload = function() {
      getLocation(initMap, initMapHood);
    };

  </script>

</body>

</html>
